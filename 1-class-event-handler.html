<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <link rel="icon" href="data:;base64,=" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>1. Introduction to browser events</title>

        <style>
            * {
                margin: 10px;
            }
        </style>
    </head>
    <body>
        <input
            type="button"
            onclick="countRabbits()"
            value="1. Count rabbits"
        />
        <input id="elem" type="button" value="2. Overwrite" />
        <button onclick="console.log(this.innerHTML)">3. this.innerHTML</button>
        <button id="button">4. Multiple handlers</button>
        <input type="button" value="5. Event object" id="moreButtons" />
        <input
            type="button"
            onclick="console.log(event.type)"
            value="6. HTML Attribute event.type"
        />
        <button id="button7">7. Oject method handleEvent()</button>
        <button id="button8">8. Class method handleEvent()</button>
        <button id="button9">9. Class method handleEvent()</button>
        <script>
            // an event is a signal that something has happened

            // all DOM nodes generate signals but events are not limited
            // to DOM

            // mouse events:

            // click
            // contextmenu
            // mouseover/mouseout
            // mousedown/mouseup
            // mousemove

            // keyboard events:

            // keydown/keyup

            // form element events:

            // submit
            // focus

            // document events:

            // DOMContentLoaded - when the HTML is loaded and processed, DOM
            // is fully built

            // CSS events:

            // transitionend - when a CSS animation finishes

            // Event handlers

            // HTML-attribute
            // on<event>
            // <input value="" onclick="alert('Click!')" type="button">
            function countRabbits() {
                for (let i = 1; i <= 3; i++) {
                    console.log('Rabbit number ' + i);
                }
            }

            // DOM property
            // on<event>
            elem.onclick = function () {
                console.log(`${this} has been clicked`);
            };

            // If the handler is assigned using an HTML-attribute then the
            // browser reads it, creates a new function from the attribute
            // content and writes it to the DOM property

            // So this way is actually the same as the previous one

            // overwrites the previous example
            elem.onclick = function () {
                console.log(`${this} has been clicked after overwrite`);
            };

            // As there's only one onclick property, we can't assign more than
            // one event handler

            // to remove
            // elem.onclick = null;

            // Accessing the element: this

            // the value of this inside a handler is the element

            // Possible mistakes

            // function sayThanks() {
            //     console.log('Thanks');
            // }

            // correct
            // button.onclick = sayThanks;

            // incorrect
            // button.onclick = sayThanks();

            // Don't us setAttribute for handlers

            // a click on <body> will generate errors,
            // because attributes are always strings, function becomes a string
            // document.body.setAttribute('onclick', function () {
            //     console.log(1);
            // });

            // DOM-property case matters

            // addEventListener

            // to assign multiple handlers to one event

            // addEventListener, removeEventListener

            // element.addEventListener(event, handler, [options])

            // event - eg: click
            // handler - the handler function
            // options - an additional optional object with properties

            // options - once, capture, passive

            // once: if true then the listener is automatically removed after
            // it triggers

            // capture: the phase where to handle the event

            // passive: if true then the handler will not call preventDefault()

            // to remove
            // element.removeEventListener(event, handler, [options])

            // Removal requires the same function

            // There's no way to 'read back' handlers assigned by
            // addEventListener unless there is a reference to it

            function handler1() {
                console.log('Thanks');
            }

            function handler2() {
                console.log('Thanks again!');
            }

            // DOM property
            button.onclick = () => console.log('hello...');

            button.addEventListener('click', handler1);
            button.addEventListener('click', handler2);

            // for some events handlers only work with addEventListener
            // will never run
            document.onDOMContentLoaded = function () {
                alert('DOM built');
            };

            document.addEventListener('DOMContentLoaded', function () {
                console.log('DOM Built');
            });

            // Event object

            // When an event happens, the browser creates an event object, puts
            // details into it and passes it as an argument to the handler

            moreButtons.onclick = function (event) {
                console.log(event.type + ' at ' + event.currentTarget);
                console.log(
                    'Coordinates: ' + event.clientX + ':' + event.clientY
                );
                // console.log(event.constructor.name);
                // for (key in event) {
                //     console.log(key);
                // }
            };

            // many of the properties depend on the type of event

            // some properties:

            // event.type
            // event.currentTarget - element that handled the event
            // event.clientX / event.clientY

            // The event object is also available in HTML handlers
            // ex: <input type="button" onclick="alert(event.type">

            // Object handlers: handleEvent

            // We can assign not just a function, but an object as an event
            // handler using addEventListener. When an event occurs, its
            // handleEvent method is called.

            let obj = {
                handleEvent(event) {
                    console.log(event.type + ' at ' + event.currentTarget);
                },
            };

            button7.addEventListener('click', obj);

            // as a class
            class Menu {
                handleEvent(event) {
                    switch (event.type) {
                        case 'mousedown':
                            button8.innerHTML = 'Mouse button pressed';
                            break;
                        case 'mouseup':
                            button8.innerHTML += '...and released.';
                            break;
                    }
                }
            }

            let menu = new Menu();
            button8.addEventListener('mousedown', menu);
            button8.addEventListener('mouseup', menu);

            // another menu
            class AnotherMenu {
                handleEvent(event) {
                    // mousedown -> onMousedown
                    let method =
                        'on' +
                        event.type[0].toUpperCase() +
                        event.type.slice(1);
                    this[method](event);
                }

                onMousedown() {
                    button9.innerHTML = 'Mouse button pressed';
                }

                onMouseup() {
                    button9.innerHTML += '...and released.';
                }
            }

            let anotherMenu = new AnotherMenu();
            button9.addEventListener('mousedown', anotherMenu);
            button9.addEventListener('mouseup', anotherMenu);
        </script>
    </body>
</html>
